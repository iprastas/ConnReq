(function(n){"use strict";function p(t,i){var a=t.toString(),u,v,y,e,h,o,r,s,l,p,c;if(a.indexOf("<!DOCTYPE")>=0){document.open();document.write(a);document.close();return}for(u=n("<div>").addClass("sgrid_caption").html(t.Caption).appendTo(i),u=n("<div>").addClass("sgrid_container").appendTo(i),v=n(i).sgrid("getSettings","nameRow4Modal"),f.length=0,u=n("<table id=sgrid>").addClass("scroll table").appendTo(u),y=n("<thead>").appendTo(u),e=0;e<t.HeaderRows.length;e++)for(h=n("<tr>").appendTo(y),o=0;o<t.Columns.length;o++)(r=t.HeaderRows[e]+"_"+t.Columns[o],t.Header[r]!==undefined)&&(s=n('<th scope="col">').attr("colspan",t.Header[r].ColSpan).attr("rowspan",t.Header[r].RowSpan).attr("id",r+"_th").appendTo(h),t.Header[r].ShowVertical===!0?(h.hasClass("vertical")||h.addClass("vertical"),n("<span>").addClass("vertical").html(t.Header[r].Value).appendTo(s)):(s.html(t.Header[r].Value),t.HeaderRows[e].toString()===v&&f.push(t.Header[r].Value)),e===0&&n(i).sgrid("getSettings","readOnly")===!0&&n(i).sgrid("getSettings","hasTreeColumn")===!1&&(n("<i>").addClass("fa fa-sort").appendTo(s),l=n(i).sgrid("getSettings","filterColumns"),l!==null&&l.indexOf(t.Columns[o])>=0&&n("<i>").addClass("fa fa-filter").prependTo(s)));p=n("<tbody>").attr("id","stbody").appendTo(u);c=0;n("table th span.vertical").each(function(){n(this).outerWidth()>c&&(c=n(this).outerWidth())});n("table tr.vertical th").height(c+10)}function w(t,i){for(var o,u,h=n(i).find("table.scroll tbody"),r=0;r<t.Rows.length;r++)for(o=n("<tr>").attr("id","row_"+t.Rows[r]).appendTo(h),u=0;u<t.Columns.length;u++){var f=t.Rows[r]+"_"+t.Columns[u],s=n("<td>").attr("id","td"+f).appendTo(o),e=t.Cells[f];e!==undefined&&(n(i).sgrid("setCellMode",s,e),n(i).sgrid("createCell",s,e,f))}t.VarRowCount===!0&&(n(i).sgrid("addRemoveIcon"),n(i).sgrid("onAddRowEvnt"),n(i).sgrid("onRemoveRowEvnt"))}function b(i,r){for(var l,s,e,c,v=n(r).find("table.scroll tbody"),o=0;o<i.Rows.length;o++)for(l=n("<tr>").attr("id","row_"+i.Rows[o]).appendTo(v),s=0;s<i.Columns.length;s++){var f=n("<td>").appendTo(l),a=i.Rows[o]+"_"+i.Columns[s],u=i.Cells[a];if(u!==undefined){f.attr("id","td"+a).attr("dataType",u.Type);(u.Type===t.Number||u.Type===t.Integer||u.Type===t.IntRange)&&f.addClass("sform-right-align");e=u.Value;switch(u.Type){case t.Boolean:e=u.BoolValue?"да":"нет";f.addClass("cell_disabled").html(e);break;case t.SelectList:e=u.options[u.Value];f.addClass("cell_disabled").html(e);break;case t.Tree:f.addClass("cell_disabled").html(e);var h=n(r).sgrid("getSettings","expanderTemplate"),y=n(r).sgrid("getSettings","indentTemplate"),p=n(r).sgrid("getSettings","expanderExpandedClass");for(h=n(h).prependTo(f),f.parent().attr("row",u.Row).attr("parentRow",u.ParentRow),c=0;c<=u.Level;c++)u.HasChildren&&h.addClass("fa fa-minus-circle"),c!==0&&n(y).insertBefore(h);break;default:f.addClass("cell_disabled").html(e)}}}}function k(i){var r=n("<div>").addClass("popup").attr("title","Ошибка ввода").appendTo(i);n("<div>").addClass("close_window").html("X").appendTo(r);n("<textarea>").attr("rows",7).attr("cols",77).attr("max-width","580px").attr("wrap","hard").attr("id","inputerror").appendTo(r);n("#stbody").on("change","input",function(){var r=n(this),u=r.prop("id").split("_",2);if(r[0].type==="file"){let e=r[0].files[0],f=r.parent();n('input[name="blobName"]',f).val(e.name);n('input[name="type"]',f).val(e.type);n('input[name="row"]',f).val(u[0]);n('input[name="col"]',f).val(u[1]);let o=u[0]+"_"+u[1],h=document.getElementById("form_"+o),s=i.sgrid("getSettings","saveBlobUrl");n.ajax({"async":!0,type:"POST",url:s,data:new FormData(h),cache:!1,contentType:!1,processData:!1}).then(function(){var h=f.parent();r.remove();n("<a>").attr("id",o).attr("name",o+"_"+t.BLob).attr("href",s).html(e.name).appendTo(h);h.prepend('<i class="fa fa-trash" aria-hidden="true" title="Удалить"><\/i>');n("td>i.fa-trash").on("click",function(){i.sgrid("deleteBlob",u[0],u[1])});return!0})}else o(i,r)});n("#stbody").on("change","textarea",function(){var t=n(this);o(i,t)});n("#stbody").on("change","select",function(){var t=n(this);o(i,t)})}function o(t,i){var h=t.sgrid("getSettings","dateDelimiter"),c=t.sgrid("getSettings","decimalDelimiter"),u=i.prop("name").split("_",3),f=i.prop("value").toString(),e,o,s;u.length===3&&(e=i.offset().left,o=i.offset().top,g(u[2],f,i.prop("min"),i.prop("max"),h,c)?(u[2]==="7"&&(f=i.prop("checked").toString()),u[2]==="3"&&r===!1&&(f=t.sgrid("toRuDate",f)),n.ajax({"async":!0,type:"POST",url:t.sgrid("getSettings","root")+t.sgrid("getSettings","posturl"),data:"r="+u[0]+"&c="+u[1]+"&val="+f,success:function(i){var f,s;if(i.error!==undefined&&i.error!==null)a(e,o,i.error);else{for(f=0;f<i.calculated.length;f++)n("input#"+i.calculated[f].Row+"_"+i.calculated[f].Column).val(i.calculated[f].Value);try{r?n("input#"+i.changed.Row+"_"+i.changed.Column).val(i.changed.Value):(s=i.changed.Value,u[2]==="3"&&(s=t.sgrid("toJsDate",s)),n("input#"+i.changed.Row+"_"+i.changed.Column).val(s))}catch(h){alert("Не заполнена структура ответа PostBackData: "+h.toString())}}},error:function(n){alert(n.responseText)}})):(s=nt(u[2],i.prop("min"),i.prop("max"),t.sgrid("getSettings","decimalDelimiter"),t.sgrid("getSettings","dateDelimiter")),a(e,o,s)))}function d(t){n("#stbody a").on("click",function(i){i.preventDefault();var r=n(this).attr("id").split("_",2);t.sgrid("setForm",0,r[0],r[1]);window.history.pushState({idForm:n(this).attr("href")},null,null)});window.onpopstate=function(n){n.state!==null&&t.sgrid("getIdForm")!==n.state.idForm&&t.sgrid("setForm",n.state.idForm,0,0)};n(t).on("formReady.sgrid",function(t){t.preventDefault();n(this).off("formReady.sgrid")});if(n(t).sgrid("getSettings","readOnly")===!0&&n(t).sgrid("getSettings","hasTreeColumn")===!1){n("th i.fa").filter(".fa-sort",".fa-sort-amount-asc",".fa-sort-amount-desc").on("click",function(n){tt(n.currentTarget.parentNode.cellIndex,t)});n("th i.fa-filter").on("click",function(i){n(t).sgrid("initFilterDialog",i.currentTarget.parentElement.cellIndex,i.currentTarget.parentElement.innerText)})}n("td").on("click","span.sgrid-expander",function(){var i=n(this);l(t,i,null)});n("td").on("click",function(i){i.target.className==="fa fa-pen"?t.sgrid("initModalRowEdit",n(i.target).parent().parent(),n(i.target).parent().text()):n(i.target.children).hasClass("fa-pen")&&t.sgrid("initModalRowEdit",n(i.target).parent(),n(i.target).text())});n("#dlgBtnSave").on("click",function(){var r=[],u={Row:0,Column:0,Value:"",Type:0},e=n("#ModalEdit"),o=t.sgrid("getSettings","dateDelimiter"),s=t.sgrid("getSettings","decimalDelimiter"),i,f;for(e.find("input , select").each(function(t,i){var f=n(i).prop("name").split("_",3),e=n(i).prop("value");u={Row:f[0],Column:f[1],Value:e,Type:f[2]};r.push(u)}),n("#ModalEdit").modal("hide"),i=0;i<r.length;i++)f=r[i].Row+"_"+r[i].Column,n("#"+f,"div.sgrid_container").prop("value",r[i].Value)});n("#dlgBtnFilter").on("click",function(){var r=n("#FilterDlg"),i="";n("#filterSelect",r).find(":selected").each(function(t,r){i=n(r).val()});i===""?t.sgrid("showAll"):t.sgrid("showOnly",i)})}function l(t,i,r){var s=n(i.closest("tr")).attr("row"),u,f,e,o;if(i.hasClass("fa-minus-circle")?(i.removeClass("fa-minus-circle").addClass("fa-plus-circle"),r=!0):i.hasClass("fa-plus-circle")&&(i.removeClass("fa-plus-circle").addClass("fa-minus-circle"),r=!1),r!==null){for(u=[],f=t.sgrid("getChildRows",s),u=f.slice(),e=0;e<u.length;e++)for(f=t.sgrid("getChildRows",u[e]),o=0;o<f.length;o++)u.push(f[o]);u.forEach(function(n){r===!0?t.sgrid("hideRow",n):t.sgrid("showRow",n)})}}function g(n,t,i,u,f,e){var o,s;if(t==="")return!0;s="^(0[1-9]|[12][0-9]|3[01])\\"+f+"(0[1-9]|1[012])\\"+f+"\\d{1,4}";switch(n){case"1":t=t.replace(/\s+/g,"");o=new RegExp("^[-+]?[0-9]*\\"+e+"?[0-9]+$");break;case"5":t=t.replace(/\s+/g,"");o=new RegExp(/^[-+]?\d+$/);break;case"3":if(r)o=new RegExp(s+"$");else return!0;break;case"4":o=new RegExp(s+"[ \\u00A0]+(\\d{2}[:]){1,2}\\d{2}$");break;case"6":return o=new RegExp(/^[-+]?\d+$/),o.test(t)?Number(t)>=Number(i)&&Number(t)<=Number(u)?!0:!1:!1;default:return!0}return o.test(t)}function a(t,i,r){n(".popup").css("left",20+n(".popup").css("width").replace("px","")/2);n(".popup").css("top",20+n(".popup").css("height").replace("px","")/2);n("#inputerror").html(r);n(".popup, .close_order, .overlay").on("click",function(){n(".popup, .overlay").css({opacity:"0",visibility:"hidden"})});n(".popup, .overlay").css({opacity:"1",visibility:"visible"})}function nt(n,t,i,r,u){switch(n){case"1":return"Введите вещественное число. Разделитель - "+r+" (Например 10"+r+"33 или 999)";case"2":return"Введите текст";case"3":return"Требуется дата в формате дд"+u+"мм"+u+"гггг";case"4":return"Дата и время в формате дд"+u+"мм"+u+"гггг чч:мин:сек ";case"5":return"Требуется целое число";case"6":return"Требуется целое число от "+t+" до "+i;case"8":return"Введите текст";case"9":return"";case"10":return"Выберите из списка";default:return""}}function v(t){t==="show"?(n("#mod-progress").modal("show"),arguments.length>=2?n("#progressBarParagraph").text(arguments[1]):n("#progressBarParagraph").text("??..."),window.progressBarActive!==!0&&n("body").css("pointer-events","none"),window.progressBarActive=!0):(setTimeout(function(){n("#progress-close").trigger("click")},1e3),window.progressBarActive=!1,n("body").css("pointer-events","auto"))}function tt(t,i){function s(t,u,f){var h=2,l=1,c=0,s=0,a=n(i).sgrid("getSettings","dateDelimiter"),e,o;return r||(a="-",h=0,c=2),e=t.split(a),o=u.split(a),s=f?parseInt(e[h])-parseInt(o[h]):parseInt(o[h])-parseInt(e[h]),s===0?(s=f?parseInt(e[l])-parseInt(o[l]):parseInt(o[l])-parseInt(e[l]),s===0?f?parseInt(e[c])-parseInt(o[c]):parseInt(o[c])-parseInt(e[c]):s):s}function c(n,t,i){var r=s(n,t,i);if(r===0){n=n.split(" ")[1];t=t.split(" ")[1];var e=0,o=1,h=2,u=n.split(":"),f=t.split(":");return r=i?parseInt(u[e])-parseInt(f[e]):parseInt(f[e])-parseInt(u[e]),r===0?(r=i?parseInt(u[o])-parseInt(f[o]):parseInt(f[o])-parseInt(u[o]),r===0&&(r=i?parseInt(u[h])-parseInt(f[h]):parseInt(f[h])-parseInt(u[h])),r):r}return r}var h=i,f=[],u=!0,e,o;n("i.fa").filter(".fa-sort",".fa-sort-amount-asc",".fa-sort-amount-desc").each(function(i){if(i===t){var r="h";n(this).hasClass("fa-sort-amount-asc")&&(r="a");n(this).hasClass("fa-sort-amount-desc")&&(r="d");n(this).removeClass("fa-sort-amount-asc fa-sort-amount-desc");(r==="h"||r==="d")&&(n(this).addClass("fa-sort-amount-asc active"),u=!0);r==="a"&&(n(this).addClass("fa-sort-amount-desc active"),u=!1)}else n(this).removeClass().addClass("header").addClass("fa fa-sort")});e=function(){this.Key="";this.KeyType=0;this.Cells=[]};o=n(h).find("tbody tr").each(function(){var i=new e;n(this).children().each(function(r){var u=n(this).text().replace(/(\r\n|\n|\r)/gm," ");r===t&&(i.Key=u,i.KeyType=n(this).attr("dataType"));i.Cells.push(u)});f.push(i)});f.sort(function(t,r){var o=n(i).sgrid("getSettings","decimalDelimiter"),f,e;switch(t.KeyType){case"2":case"8":case"7":if(t.Key===r.Key)return 0;if(t.Key>r.Key)return u?1:-1;if(t.Key<r.Key)return u?-1:1;break;case"1":return f=t.Key.replace(o,"."),e=r.Key.replace(o,"."),u?parseFloat(f)-parseFloat(e):parseFloat(e)-parseFloat(f);case"5":case"6":return u?t.Key-r.Key:r.Key-t.Key;case"3":return s(t.Key,r.Key,u);case"4":return c(t.Key,r.Key,u)}});o.each(function(t){var i=f[t];n(this).children().each(function(t){n(this).text(i.Cells[t])})})}function it(n){for(var r,i={},t=0;t<n.length;t++)r=n[t],i[r]=!0;return Object.keys(i)}var s="",h=null,y=1e4,f=[],c="",r=!1,e=!1,u;const t=Object.freeze({Empty:0,Number:1,Text:2,Date:3,DateTime:4,Integer:5,IntRange:6,Boolean:7,CLob:8,BLob:9,SelectList:10,Button:11,Tree:12}),i=Object.freeze({Disable:0,Input:1,Calculate:2,History:3,InputRO:4,HistoryRO:5,Header:6,Error:7,OutRef:8,Cumulative:9});u={initGrid:function(t){var i=n.extend({},{geturl:null,posturl:null,getImgUrl:null,cellsDataUrl:null,saveBlobUrl:null,getBlobUrl:null,showAlert:!1,decimalDelimiter:",",dateDelimiter:".",formMode:"Input",readOnly:!1,root:"",hasTreeColumn:!1,expanderTemplate:'<span class="sgrid-expander"><\/span>',indentTemplate:'<span class="sgrid-indent"><\/span>',expanderExpandedClass:"fa fa-minus-circle",expanderCollapsedClass:"fa fa-plus-circle",modalRowEdit:!1,nameRow4Modal:null,nameCol4Modal:null,filterColumns:null,formId:0},t);return this.each(function(){var t=n(this);t.sgrid("setGridContainer",n(this));t.sgrid("setSettings",i);h=i.formId;t.sgrid("setForm",0,0,0);t.sgrid("createProgressBar",n(this));i.modalRowEdit==="true"&&t.sgrid("createModalEdit",n(this));i.filterColumns!==null&&i.filterColumns.length>0&&t.sgrid("createFilterDialog",n(this));r=t.sgrid("detectIE")})},detectIE:function(){var n=window.navigator.userAgent,i=n.indexOf("MSIE "),t;return i>0?!0:(t=n.indexOf("Trident/"),t>0)?!0:!1},setGridContainer:function(t){return n(this).data("sgrid",t)},getGridContainer:function(){return n(this).data("sgrid")},getSettings:function(t){return n(this).sgrid("getGridContainer")?n(this).sgrid("getGridContainer").data("settings")[t]:null},setSettings:function(t){n(this).sgrid("getGridContainer").data("settings",t)},changeSetting:function(t,i){n(this).sgrid("getGridContainer").data("settings")[t]=i},createProgressBar:function(t){var f=n('<div class="modal fade in" id="mod-progress" role="dialog">').appendTo(n(t)),i=n("<div>").addClass("modal-dialog").appendTo(f),r=n("<div>").addClass("modal-content").appendTo(i).css("height","180px"),e=n("<div>").addClass("modal-body").appendTo(r).css("max-height","180px"),u;i=n("<div>").addClass("text-center").appendTo(e);i=n('<div id="result" style="font-size: 1.1em; padding-bottom: 5px">').appendTo(i);n('<p id="progressBarParagraph">').appendTo(i);i=n('<div id="ProgressStripe" class="progress progress-striped active" style="position:relative; top:10px; width:100%;">').insertAfter(i);n('<div id="ProgressMessage" class="progress-bar progress-bar-info" style="width: 100%; border:none;"><\/div>').appendTo(i);u=n('<div class="modal-footer">').html("Остановить процесс - Esc").appendTo(r);n('<button id="progress-close" type="button" class="btn btn-secondary" data-dismiss="modal" hidden="hidden">').appendTo(u).html("Закрыть")},createModalEdit:function(t){var f=n('<div class="modal fade" id="ModalEdit" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true">').appendTo(t),e=n('<div class="modal-dialog" max-height:100%;  margin-top: 50px; margin-bottom:50px;">').appendTo(f),i=n('<div class="modal-content">').appendTo(e),r=n('<div class="modal-header">').appendTo(i),u=n('<button type="button" class="close" data-dismiss="modal">').appendTo(r);n('<span aria-hidden="true">&times;<\/span>').appendTo(u);n('<span class="sr-only">Close<\/span>').appendTo(u);n('<h4 class="modal-title" id="ModalLabel">Modal title<\/h4>').appendTo(r);var o=n('<div class="modal-body">').appendTo(i),h=n('<form class="form-horizontal" role="form">').appendTo(o),s=n('<div class="modal-footer">').appendTo(i);n('<button type="button" class="btn btn-primary" id="dlgBtnSave">Закрыть<\/button>').appendTo(s)},initModalRowEdit:function(t,i){var r=n("#ModalEdit"),u=r.find("div.modal-body");u.children().remove();n("#ModalLabel").text(i);t.children().each(function(t,i){var e,r,o;n(i).hasClass("cell_input")===!0&&(e=n('<form class="form-horizontal" role="form">').appendTo(u),r=n('<div class="form-group">').appendTo(e),n('<label  class="col-md-6 control-label">'+f[t]+"<\/label>").appendTo(r),o=n('<div class="col-md-6">').appendTo(r),n(i).find("input:enabled , select:enabled , textarea:enabled").clone(!0).appendTo(o))});r.modal("show")},createFilterDialog:function(t){var e=n('<div class="modal fade" id="FilterDlg" tabindex="-1" role="dialog" aria-labelledby="FilterDlgLabel" aria-hidden="true">').appendTo(t),o=n('<div class="modal-dialog" max-height:100%;  margin-top: 50px; margin-bottom:50px;">').appendTo(e),i=n('<div class="modal-content">').appendTo(o),r=n('<div class="modal-header">').appendTo(i),u=n('<button type="button" class="close" data-dismiss="modal">').appendTo(r);n('<span aria-hidden="true">&times;<\/span>').appendTo(u);n('<span class="sr-only">Close<\/span>').appendTo(u);n('<h4 class="modal-title" id="FilterDlgLabel"><\/h4>').appendTo(r);var s=n('<div class="modal-body">').appendTo(i),h=n('<form class="form-horizontal" role="form">').appendTo(s),f=n('<div class="form-group">',"#FilterDlg").appendTo(h);n('<label  class="col-md-6 control-label">Выберите из списка<\/label>').appendTo(f);var c=n('<div class="col-md-6">',"#FilterDlg").appendTo(f),a=n('<select id="filterSelect"><\/select>').appendTo(c),l=n('<div class="modal-footer">').appendTo(i);n('<button type="button" class="btn btn-primary" id="dlgBtnFilter" data-dismiss="modal">Фильтровать<\/button>').appendTo(l)},initFilterDialog:function(t,i){var e=[],u,f,r;for(c=t,n("td[id*=_"+t+"]").each(function(){e.push(this.innerText)}),u=it(e),n("#FilterDlgLabel").text(i),f=n("#filterSelect","#FilterDlg"),f.children().remove(),n("<option>").attr("value","").text("").appendTo(f),r=0;r<u.length;r++)n("<option>").attr("value",u[r]).text(u[r]).appendTo(f);n("#FilterDlg").modal("show")},showAll:function(){n("tr:hidden",this).show()},showOnly:function(t){n("td[id*=_"+c+"]").each(function(){this.innerText===t?n(this).parent("tr").show():n(this).parent("tr").hide()})},setIdForm:function(n){s=n},getIdForm:function(){return s},getStartFormId:function(){return h},setForm:function(t,i,r){var u=n(this);u.sgrid("clearForm");u.sgrid("setIdForm",t);let f=u.sgrid("getSettings","root")+u.sgrid("getSettings","geturl");return n.ajax({"async":!0,type:"GET",data:"id="+t+"&r="+i+"&c="+r,cache:!1,url:f,success:function(n){var t=u.sgrid("getSettings","readOnly");e=n.VarRowCount?!0:!1;p(n,u);t===!0?b(n,u):(w(n,u),k(u));d(u);u.trigger("formReady.sgrid");u.sgrid("setPencil")},error:function(n){u.trigger("formReady.sgrid");alert("Ошибка чтения данных setForm. Статус -  "+n.status)}})},getCurrentFormData:function(){return fData},clearForm:function(){var t=n(this).sgrid("getGridContainer");n(t).find("div.sgrid_container").remove();n(t).find("div.sgrid_caption").remove()},updateCell:function(u){var s=u.Row+"_"+u.Column,o=u.Value,b=u.Type,a=u.Mode,k=u.Tooltip,e=null,y,c,h,f,p,l,v,w;if(a===i.Header){s=s+"_th";e=n("[id='"+s+"']");o!==undefined&&e[0]!==undefined&&(e[0].innerText=o);return}if(y=n(this).sgrid("getGridContainer"),c=(a===i.Input||a===i.History)&&n(y).sgrid("getSettings","readOnly")==="false",e=n("[id='td"+s+"']"),e!==null&&e!==undefined){if(e.length===0&&n(this).sgrid("newCell",u),a===i.Error){s="td"+s;e=n("[id='"+s+"']");e.removeClass().addClass("cell_error").attr("title",o);e.children().val("");return}if(h=n("td#td"+s).attr("title",k),n(this).sgrid("setCellMode",h,u),e.length>0){f=n("input",e[0]);let i=!1;f.length===0&&(f=n("<input>").attr("name",s+"_"+u.Type).attr("id",s),i=!0);switch(b){case t.Number:case t.DateTime:case t.Integer:case t.IntRange:c===!0?(f.removeAttr("disabled").removeAttr("readonly"),f.val(o),h.html(""),i&&f.appendTo(h)):h.html(o).attr("datatype",u.Type);break;case t.Date:r||c!==!0||(o=n(this).sgrid("toJsDate",o));c===!0?f.removeAttr("disabled").removeAttr("readonly",""):f.val(o).attr("disabled","").attr("readonly","");f.val(o);(i||o.length>0)&&f.appendTo(h);break;case t.Text:c===!0?(i&&f.appendTo(h),f.removeAttr("disabled").removeAttr("readonly",""),f.val(o),h.html("")):h.html(o);break;case t.Boolean:f=n("input",e[0]);c===!0?f.removeAttr("disabled"):f.attr("disabled","disabled");p=n(e[0]);p.prop("checked",o);break;case t.CLob:f=n("textarea",e[0]);c===!0?f.removeAttr("disabled").removeAttr("readonly",""):f.attr("disabled","disabled").attr("readonly");f.val(o);break;case t.BLob:c&&u.Value.length===0?n('<input type="file" accept=".pdf,.doc,.docx,.jpeg,.png"/>').attr("id",s).appendTo(h):u.Value.length>0&&(f.attr("type","text").attr("value",u.Value).addClass("sform-right-align").attr("disabled","disabled").appendTo(h),h.prepend('<i class="fa fa-times" aria-hidden="true" title="Удалить"><\/i>'));break;case t.SelectList:l=n("select#"+s);l===undefined&&(l=n("<select>").attr("name",s+"_"+u.Type).attr("id",s).appendTo(h));c||l.attr("disabled","disabled");for(v in u.options)w=n("<option>").attr("value",v).html(u.options[v]).appendTo(l),u.options[v]===u.Value&&w.attr("selected","selected");break;case t.Button:n(e[0]).attr("href",o)}}}},newCell:function(r){var e=r.Row+"_"+r.Column,o=n("tbody#stbody",this),f=n("#row_"+r.Row,o),u;f.length===0&&(f=n("<tr>").attr("id","row_"+r.Row).appendTo(o));u=n("<td>").attr("id","td"+e).attr("dataType",r.Type).appendTo(f);this.sgrid("setCellMode",u,r);(r.Type===t.Number||r.Type===t.Integer||r.Type===t.IntRange)&&u.addClass("sform-right-align");this.sgrid("getSettings","readOnly")==="true"&&r.Mode!==i.InputRO?u.addClass("cell_disabled").html(r.Value):this.sgrid("createCell",u,r,e)},changeMode:function(t){if(settings.formMode!==t){switch(t){case"Input":n("td.cell_input",this).children().removeAttr("disabled");n("td.cell_fromhistory",this).children().attr("disabled","disabled");break;case"History":n("td.cell_input",this).children().attr("disabled","disabled");n("td.cell_fromhistory",this).children().removeAttr("disabled");break;default:alert("mode может принимать значения: Input , History !")}settings.formMode=t}},getCellsData:function(t,i){i=i||0;var u=!1,r=n(this);n(document).on("keydown",function(n){n.which===27&&(u=!0)});return n.ajax({url:r.sgrid("getSettings","root")+r.sgrid("getSettings","cellsDataUrl")+"?i="+t.toString()+"&lv="+i.toString(),"async":!0,cache:!1,success:function(n){var t,f;if(r.trigger("stopSpinner.sgrid"),n.cells!==undefined){for(t=0;t<n.cells.length;t++)r.sgrid("updateCell",n.cells[t]);if(n.Percent>="100"||u||i>=y){v("hide");r.trigger("dataReady.sgrid");return}f=i+1;r.sgrid("getCellsData",1,f)}else r.trigger("dataReady.sgrid"),n.indexOf("<!DOCTYPE")===0&&document.write(n)},error:function(n){alert("Ошибка чтения данных getCellsData. Статус -  "+n.status);r.trigger("stopSpinner.sgrid");v()}})},getChildRows:function(t){var r=n(this),i=[];return r.find("tbody").find("tr").each(function(r,u){n(u).attr("parentrow")===t&&i.push(n(u).attr("row"))}),i},hideRow:function(t){n("tr[row="+t+"]").hide()},showRow:function(t){n("tr[row="+t+"]").show()},setPencil:function(){var t=n(this),i=t.sgrid("getSettings","nameCol4Modal");t.sgrid("getSettings","modalRowEdit")==="true"&&n("tr td").each(function(t,r){var u=r.id.split("_",2);u.length>1&&u[1]===i&&n(r).prepend('<i class="fa fa-pen"><\/i>')})},addRemoveIcon:function(){var t=n(this);n("tbody tr td:first-child",t).prepend('<i class="fa fa-trash"><\/i>');n("tbody tr:last td i",t).removeClass("fa-trash").addClass("fa fa-plus-circle")},onRemoveRowEvnt:function(){var t=n(this);n("td > i.fa-trash").on("click",function(i){var r=n(i.target.parentElement),u=r.attr("id").replace("td",""),f=u.slice("_");t.sgrid("rowDeleted",f[0]);r.parent().remove()})},onAddRowEvnt:function(){var t=n(this);n("td > i.fa-plus-sign").on("click",function(i){var r=n(i.target.parentElement),u=r.attr("id").replace("td",""),f=u.slice("_");t.sgrid("addRow",f[0])})},offRemoveRowEvnt:function(){n("td > i.fa-trash").off("click")},offAddRowEvnt:function(){n("td > i.fa-plus-sign").off("click")},rowDeleted:function(t){n(this).trigger("rowChanged.sgrid",[t,0])},addRow:function(t){var i=n(this),r;i.sgrid("offRemoveRowEvnt");i.sgrid("offAddRowEvnt");r=parseInt(t)+1;n("tbody tr:last td:first i",i).removeClass("fa fa-plus-sign").addClass("fa fa-trash");n("tbody tr:last",i).clone(!0).appendTo("tbody");n("tbody tr:last td:first i",i).removeClass("fa fa-trash").addClass("fa fa-plus-sign");n("tbody tr:last td",i).each(function(i,u){var f=n(u).prop("id"),e=f.replace("td"+t,"td"+r);n(u).prop("id",e);n("input , textarea , select",n(u)).each(function(i,u){var o=n(u).prop("name"),s=o.replace(t+"_",r+"_"),f,e;n(u).prop("name",s);f=n(u).prop("id");e=f.replace(t+"_",r+"_");n(u).prop("id",e);n(u).prop("value","")})});i.sgrid("onRemoveRowEvnt");i.sgrid("onAddRowEvnt");n(this).trigger("rowChanged.sgrid",[r,1])},getTableHtml:function(){var t=n(this);return n(".sgrid_container",t).html()},toJsDate:function(n){if(n.length>0){var t=n.split(".",3);return t[2]+"-"+t[1]+"-"+t[0]}return n},toRuDate:function(n){if(n.length>0){var t=n.split("-",3);return t[2]+"-"+t[1]+"-"+t[0]}return n},deleteRow:function(t){n("#row_"+t,this).remove()},deleteAllRows:function(){e&&n("tbody",this).children().remove()},setCellMode:function(n,r){n.removeClass();switch(r.Mode){case i.Disable:n.addClass("cell_disabled").attr("dataType",r.Type).html(r.Value);(r.Type===t.Number||r.Type===t.Integer||r.Type===t.IntRange)&&n.addClass("sform-right-align");break;case i.Input:case i.InputRO:n.addClass("cell_input");break;case i.Calculate:n.addClass("cell_calculated");break;case i.History:case i.HistoryRO:n.addClass("cell_fromhistory");break;case i.OutRef:n.addClass("cell_outref");break;case i.Cumulative:n.addClass("cell_cumulative")}},newRow:function(i,r){var o=n(this),a=o,v=n(this).find("table.scroll tbody"),s,c=1,f,u,h,e;for(r===null||r===undefined?s=n("<tr>").attr("id","row_"+i[0].Row).appendTo(v):(f=n("tr#row_"+r),n(".sgrid-expander",f).addClass("fa fa-minus-circle"),n("span",f).each(function(){c++}),s=n("<tr>").attr("id","row_"+i[0].Row).insertAfter(f)),u=0;u<i.length;u++){if(h=i[u].Row+"_"+i[u].Column,e=n("<td>").attr("id","td"+h).appendTo(s),i[u].Type===t.Tree&&(r!==null||r!==undefined)){i[u].Level=c;i[u].ParentRow=r;e.on("click","span.sgrid-expander",function(){var t=n(this);l(a,t,null)})}o.sgrid("setCellMode",e,i[u]);o.sgrid("createCell",e,i[u],h)}},createCell:function(u,f,e){var h=n(this),y="дд.мм.гггг",s=f.Mode===i.Input||f.Mode===i.History,o,p,w,v,l,b,c,k,a;f.Tooltip!==undefined&&f.Tooltip!==null&&f.Tooltip.length>0&&u.attr("title",f.Tooltip);o=n("<input>").attr("name",e+"_"+f.Type).attr("id",e);switch(f.Type){case t.Number:o.attr("type","text").addClass("sform-right-align").attr("value",f.Value);s?(o.attr("placeholder","0,0"),o.appendTo(u),u.html("")):u.html(f.Value);break;case t.Text:s?o.attr("type","text").attr("value",f.Value).attr("placeholder","введите текст").appendTo(u):[i.InputRO,i.HistoryRO,i.OutRef,i.Cumulative].includes(f.Mode)?(o.attr("type","text").addClass("sform-left-align").attr("value",f.Value).attr("disabled","disabled"),o.appendTo(u)):u.addClass("sform-left-align").html(f.Value);break;case t.Date:!r&&f.Value.length>0&&(f.Value=this.sgrid("toJsDate",f.Value));o.attr("type","date").attr("value",f.Value);s?o.attr("placeholder",y):o.attr("disabled","disabled").attr("readonly","");(s||f.Value.length>0)&&o.appendTo(u);break;case t.DateTime:o.attr("type","text").attr("value",f.Value);s?o.attr("placeholder",y+" 00:00:00"):o.attr("disabled","disabled").attr("readonly","");(s||f.Value.length>0)&&o.appendTo(u);break;case t.Integer:o.attr("type","text").attr("value",f.Value).addClass("sform-right-align");s?o.attr("type","text").attr("placeholder","введите целое"):o.attr("disabled","disabled").attr("readonly","");o.appendTo(u);break;case t.IntRange:o.attr("type","text").attr("value",f.Value).addClass("sform-right-align");s?o.attr("type","text").attr("min",f.Min).attr("max",f.Max).attr("placeholder","целое от "+f.Min+" до "+f.Max):o.attr("disabled","disabled").attr("readonly","");o.appendTo(u);break;case t.Boolean:o.attr("type","checkbox").attr("name",e+"_"+f.Type).appendTo(u).after(f.Value);o.prop("checked",f.BoolValue);s||o.attr("disabled","disabled");break;case t.CLob:p=n("<textarea>").attr("id",e).attr("name",e+"_"+f.Type).attr("rows",f.Rows).attr("cols",f.Cols).html(f.Value).appendTo(u);s||p.attr("disabled","disabled");break;case t.BLob:if(s&&f.Value.length===0&&h.sgrid("addBlobForm",u,e),f.Value.length>0&&(w=h.sgrid("getSettings","root")+h.sgrid("getSettings","getBlobUrl")+"?row="+f.Row+"&col="+f.Column,n("<a>").attr("id",e).attr("name",e+"_"+f.Type).attr("href",w).html(f.Value).appendTo(u)),s&&f.Value.length>0){u.prepend('<i class="fa fa-trash" aria-hidden="true" title="Удалить"><\/i>');n("td#td"+e+">i.fa-trash").on("click",function(){h.sgrid("deleteBlob",f.Row,f.Column)})}break;case t.SelectList:v=n("<select>").attr("name",e+"_"+f.Type).attr("id",e).appendTo(u);s||v.attr("disabled","disabled");for(l in f.options)b=n("<option>").attr("value",l).html(f.options[l]).appendTo(v),l===f.Value&&b.attr("selected","selected");break;case t.Button:n("<a>").attr("id",e).attr("name",e+"_"+f.Type).attr("class","btn btn-primary").attr("href",f.Url).html(f.Value).appendTo(u);break;case t.Tree:for(s?o.attr("type","text").attr("value",f.Value).attr("placeholder","введите текст").appendTo(u):f.Mode===i.InputRO||f.Mode===i.HistoryRO||f.Mode===i.OutRef||f.Mode===i.Cumulative?(o.attr("type","text").addClass("sform-left-align").attr("value",f.Value).attr("disabled","disabled"),o.appendTo(u)):u.addClass("sform-left-align").html(f.Value),c=h.sgrid("getSettings","expanderTemplate"),k=h.sgrid("getSettings","indentTemplate"),c=n(c).prependTo(u),u.parent().attr("row",f.Row).attr("parentRow",f.ParentRow),a=0;a<=f.Level;a++)f.HasChildren&&c.addClass("fa fa-minus-circle"),a!==0&&n(k).insertBefore(c)}},setCellBottomBorderColor:function(n,t){n.css("border-bottom",t)},addBlobForm:function(t,i){var r=n(this),u=jQuery("<form>",{id:"form_"+i,method:"POST",enctype:"multipart/form-data"}).append(jQuery("<input>",{name:"blobData",accept:".pdf,.doc,.docx,.jpeg,.png",type:"file",id:i})).append(n("<input>",{name:"blobName",value:"",hidden:"hidden"})).append(n("<input>",{name:"type",value:"",hidden:"hidden"})).append(n("<input>",{name:"row",value:"",hidden:"hidden"})).append(n("<input>",{name:"col",value:"",hidden:"hidden"})).append(n("<input>",{type:"submit",value:"Сохранить",hidden:"hidden"})).appendTo(t)},deleteBlob:function(t,i){var u=n(this),r=new FormData;r.append("blobData",null);r.append("row",t);r.append("col",i);n.ajax({"async":!0,type:"POST",url:u.sgrid("getSettings","root")+u.sgrid("getSettings","saveBlobUrl"),data:r,cache:!1,contentType:!1,processData:!1,error:function(t){n.notify("Ошибка deleteBlob. Статус -  "+t.status+" Техт: "+t.responseText,{clickToHide:!1,autoHideDelay:1e4})}}).then(function(){var r=t+"_"+i,f=n("td#td"+r);return f.children().remove(),u.sgrid("addBlobForm",f,r),!0})}};n.fn.sgrid=function(t){if(u[t])return u[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t!="object"&&t)n.error("Method with name "+t+" does not exists for jQuery.sgrid");else return u.initGrid.apply(this,arguments)}})(jQuery);